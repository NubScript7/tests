<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>visits counter</title>
  
  <!-- HTML -->
  

  <!-- Custom Styles -->
  <link rel="stylesheet" href="style.css">
</head>

<body>
	<h1>VISITS</h1>
	<p class="visits">initializing...</p>

  <script type="module">
  	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
  	import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics.js";
  	import { getDatabase, get, set, update, ref, child } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
  	let firebaseConfig;
	fetch("https://nubscript7.github.io/json-placeholder/firebase/config.json")
	.then(res=>res.json())
	.then(e=>e=firebaseConfig)
	console.log(firebaseConfig)

  	const app = initializeApp(firebaseConfig);
  	const analytics = getAnalytics(app);
  	const visitsCounter = document.querySelector('.visits');
  	let db = getDatabase();
  	let visits = 0;
  	document.body.onload = () => {
  		get(child(ref(db), "Visits/totalVisits"))
  			.then(visit => {
  				if (visit.exists()) {
  					visits = visit.val();
  					visits++
  	
  					update(ref(db, "Visits/"), {
  						totalVisits: visits
  					})
  					visitsCounter.textContent = `visited ${visits} times!`
  				}
  			})
  	}
  </script>
</body>
</html>
